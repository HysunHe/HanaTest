<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.oracle.oda.ext.dao.FileMapper">

	<select id="query" resultType="com.oracle.oda.ext.domains.File" databaseId="mysql">
		SELECT 
			ID as id, 
			SERIAL_NO as serial_no,
			CHECKSUM as checksum,
			FILENAME as filename,
			FILE_ID as file_id,
			LINK_ID as link_id,
			PUBLIC_URI as public_uri,
			BATCH_NUMBER as batch_number,
			COMMODITY_ID as commodity_id,
			CREATED_AT as created_at,
			UPDATED_AT as updated_at
		FROM BOT_FILES
		WHERE 1=1
		<if test="commodity_id != null">
			AND COMMODITY_ID = #{commodity_id}
		</if>
		<if test="batch_number != null">
			AND BATCH_NUMBER = #{batch_number}
		</if>
		ORDER BY UPDATED_AT DESC
		LIMIT #{offset}, #{limit}
	</select>
		
	<insert id="save" parameterType="com.oracle.oda.ext.domains.File" databaseId="mysql">
		REPLACE INTO BOT_FILES
		(
			ID,
			SERIAL_NO,
			CHECKSUM,
			FILENAME,
			FILE_ID,
			LINK_ID,
			PUBLIC_URI,
			BATCH_NUMBER,
			COMMODITY_ID,
			CREATED_AT,
			UPDATED_AT
		) VALUES (
			#{id},
			#{serial_no},
			#{checksum},
			#{filename},
			#{file_id},
			#{link_id},
			#{public_uri},
			#{batch_number},
			#{commodity_id},
			#{created_at},
			#{updated_at}
		)	
	</insert>
</mapper>